# Algorithm forecasting Power Consumption in Tatarstan 2024 (XGBoost only)

В этой ветке:
1) Данные о потреблении получены **напрямую** от АО "Татэнергосбыт"
2) Скрипт адаптирован под работу на РСВ

В этой версии (`daily_forecast_Tatarstan_XGBoost.ipynb`):
1) 24-й час переконвертирован в 0-й (под DataTime-формат)
2) Решена проблема с экстраполяцией температуры (задействован 0-й час следующих суток в процессе интерполяции)
3) Столбец `Date` больше не удаляется из базы данных (используется для слияние погодной и "потребительских" таблиц)
4) Добавлена функция `get_empty_daily_df(date)` для формирования пустого датафрейма на указанную дату (25 строк: с 0:00 до 0:00)
5) Добавлена функция `add_date_scalar(df)` для заполнения датафрейма категориальными (календарными) признаками от DataTime-объекта
6) Добавлена функция `get_weather(date)` для получения датафрейма с архивом/прогнозом погоды на указанную дату (24 строки: с 1:00 до 0:00)
7) Реализована возможность пополнения БД оперативными данными (xlsx-файл, *приложение 2*) с актуальными (архивными, а не прогнозными) сведениями о погоде
8) Функция `prepareData(df, lag_start, lag_end)` получила 3 перегрузки, интервал лага по-умолчанию: 1 полная неделя
9) Добавлена опция выбора горизонта планирования (1 и более суток) с помощью функции `get_df_predicted(df_general, df_test, date_start, date_end)`. Функция имеет 3 перегрузки, горизонт по умолчанию: текущие + прогнозные сутки (48 часов)
10) Исследуемый период в функции `search_HP` вычитается не от начала года, а от текущей даты
11) Тестовая выборка формируется внутри `search_HP`. Размер выборки: 1 календарный год. Отсчёт выполняется от текущей даты
12) Результат прогнозирования экспортируется в xlsx-файл в директории блокнота
13) Функция `diff_predict_vs_fact(df_predicted)` адаптирована под работу с суточными фреймами

Дальнейшая работа:
1) выполнить валидацию полученного решения
2) провести долгосрочное наблюдение
3) рассмотреть вариант без использования лага последних суток (2, 7) для исключения накопленной погрешности от прогнозирования текущих суток
4) в функции `prepareData(df, lag_start, lag_end)` рализовать лаг не построчно, а с привязкой к дате

В предыдущей версии (`volume_energy_analisys_XGBoost.ipynb`):
1) Архивная база данных о погоде получена через ресурс https://kazan.nuipogoda.ru
2) Валидация выполнена из расчета доступа к данным на 11 утра -1 суток до дня прогнозирования
3) Усредненный результат по валидационной выборке (01.01.24-28.05.24): 1.53% (40.47 МВт)
4) По месяцам: 
- January 2024 MAPE: 1.646%
- February 2024 MAPE: 1.074%
- March 2024 MAPE: 1.086%
- April 2024 MAPE: 1.693%
- May 2024 MAPE: 2.202%